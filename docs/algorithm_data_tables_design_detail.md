

问题：用户偏好特征 -`> 边界情况 ->` 只玩过一个类目：该类目偏好最高，但其他类目仍有先验值？

这是关于 **Laplace 平滑**（拉普拉斯平滑）的设计。让我用一个具体例子解释：

## 问题背景

假设用户只玩过 Slots 类目的游戏，如果不做平滑处理：

```
pref_category_slots = 1.0    # 100%
pref_category_crash = 0.0    # 0%
pref_category_live = 0.0     # 0%
pref_category_virtual = 0.0  # 0%
```

这样会导致两个问题：

1. **概率为0**：精排模型中其他类目的推荐概率为0，完全无法探索
2. **过度自信**：仅凭少量行为就认定用户100%只喜欢Slots

---

## 解决方案：Laplace 平滑

在代码中，我们给每个类目设置了一个**先验分数**：

```python
PRIOR = 1.0  # 每个类目的初始分数
category_scores = {
    'slots': 1.0,    # 先验
    'crash': 1.0,    # 先验
    'live': 1.0,     # 先验
    'virtual': 1.0   # 先验
}
```

然后再累加用户的实际行为分数。

---

## 具体例子

用户只玩过 Slots，行为加权得分为 50：

| 类目    | 先验分 | 行为分 | 总分 | 归一化后偏好度         |
| ------- | ------ | ------ | ---- | ---------------------- |
| Slots   | 1.0    | 50     | 51   | 51/54 =**0.944** |
| Crash   | 1.0    | 0      | 1    | 1/54 =**0.019**  |
| Live    | 1.0    | 0      | 1    | 1/54 =**0.019**  |
| Virtual | 1.0    | 0      | 1    | 1/54 =**0.019**  |

可以看到：

- Slots 偏好度最高（0.944），符合用户行为
- 其他类目不是0，而是有一个很小的值（0.019）

---

## 为什么这样设计？

1. **保留探索空间**：推荐系统可以偶尔推荐用户未尝试过的类目
2. **避免冷启动问题**：新用户行为少时不会过度极端
3. **概率分布有效**：四个值之和仍然等于1

这就是"先验值"的含义——在没有观察到用户行为之前，我们假设用户对所有类目有相同的微小兴趣。
